<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>订单详情</title>

    <!-- Bootstrap -->
    <link href="./resource/css/bootstrap.min.css" rel="stylesheet">
    <link href="./resource/css/style.css" rel="stylesheet">
    <link href="./resource/css/city-picker.css" rel="stylesheet">

    <!-- HTML5 shim 和 Respond.js 是为了让 IE8 支持 HTML5 元素和媒体查询（media queries）功能 -->
    <!-- 警告：通过 file:// 协议（就是直接将 html 页面拖拽到浏览器中）访问页面时 Respond.js 不起作用 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div class="order-info-addr">
    <ul class="list-group">
        <li class="list-group-item">
            <div class="item-name"><img src="resource/images/dengdaifahuo_icon.png"></div>
            <div class="item-input" id="orderState">等待商家发货</div>
            <div class="clear"></div>
        </li>
        <li class="list-group-item" style="height: 80px">
            <div class="addr-img">
                <img src="resource/images/fahuodizhi_icon.png" style="width: 30%">
            </div>
            <div class="addr-info">
                <div class="addr-name">收货人：<span id="name"></span></span><span style="float: right"
                                                                               id="contacts">123213213</span></div>
                <div class="addr-text">收货地址：<span id="addr"></span></div>
            </div>
            <!--
            <div class="item-name addr-icon"><img src="resource/images/fahuodizhi_icon.png"></div>
            <div >
                <div><span>收货人：<span id="name"></span></span><span style="float: right">123213213</span></div>
                <div>收货地址:<span id="addr"></span></div>
            </div>
            <div class="clear"></div>
            -->
        </li>
    </ul>
</div>
<div class="order-product" style="padding-top: 0px;">
    <div class="order-no">订单号：<span id="orderId"></span></div>
    <div class="list-left">
        <div class="product-img">
            <img src="./resource/images/code-img.png" class="img-responsive">
        </div>
    </div>
    <div class="list-center">
        <span id="proTitle"></span>

        <p>羊编号：<span id="extra"></span></p>
    </div>
    <div class="list-right">
        <div class="product-price atnl-color-qd">￥<span id="proPrice">2000</span></div>
        <div class="product-num">
            x&nbsp;<span id="productnum">1</span>
        </div>
    </div>
    <div class="clear"></div>
</div>
<div class="order-item atnl-bgcolor-1">
    <div class="order-send-time-t">发货时间</div>
    <div class="order-send-time-d"><span id="sendDate"></span>&nbsp;&nbsp;开始发货</div>
    <div class="clear"></div>
</div>
<div class="order-item atnl-bgcolor-1">
    <div class="order-send-time-t">买家留言</div>
    <div class="order-send-time-d"><label id="msg"></label></div>
    <div class="clear"></div>
</div>
<div class="order-item atnl-bgcolor-1">
    <div class="order-send-time-t">物流编号</div>
    <div class="order-send-time-d" id="trackno">aaaaaaaa</div>
    <div class="clear"></div>
</div>
<div class="order-item atnl-bgcolor-1">
    <div class="order-send-time-t">客服</div>
    <div class="order-send-time-d"  id="btnCoupon">
        <span class="glyphicon glyphicon-chevron-right"></span></div>
    <div class="clear"></div>
</div>
<div class="order-item-h atnl-bgcolor-1">
    <div class="order-send-time-t">商品金额</div>
    <div class="order-send-time-d"><span class="atnl-color-qd">￥<span id="countMoney">0</span></span></div>
    <div class="order-send-time-t">优惠</div>
    <div class="order-send-time-d"><span class="atnl-color-qd">-￥<span id="couponMoney">0</span></span></div>
    <div class="order-send-time-t">实付金额</div>
    <div class="order-send-time-d"><span class="atnl-color-qd">￥<span id="realPrice">0</span></span></div>
    <div class="clear"></div>
</div>
<div class="order-item atnl-bgcolor-1">
    <div class="order-send-time-t">支付方式</div>
    <div class="order-send-time-d" id="payWay"></div>
    <div class="clear"></div>
</div>
<div class="order-item-h">
    <div class="order-send-time-t">创建时间</div>
    <div class="order-send-time-d"><span class="atnl-color-qd" id="createTime"></span></div>
    <div class="order-send-time-t">付款时间</div>
    <div class="order-send-time-d"><span class="atnl-color-qd" id="paytime"></span></div>
    <div class="clear"></div>
</div>


<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     style="transform: translateY(10%)"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
            </div>
            <div class="modal-body" id="couponList">
                <img src="resource/images/erweima.png" class="img-responsive">
            </div>
            <div class="modal-footer " style="text-align: center">
                <span>扫一扫添加客服微信</span>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>

<div class="bottom-payway-eth navbar-fixed-bottom" id="payWayEth" hidden>
    <div style="width: 100%;height: 15px">
        <i class="glyphicon glyphicon-remove pull-right" id="closeEthPay"></i>
    </div>
    <p>我们每天晚上九点后进行ETH对账，会更新订单状态</p>
    <p>已购88元抵288活动的用户请联系客服返现</p>

    <div class="eth-ts atnl-color-2">你需要支付<span id="eth"></span>个Eth,购买整只羊羔礼盒</div>
    <div class="eth-ts atnl-color-2">官方收款地址</div>
    <div class="eth-ts atnl-color-2">0x82Df18eB4C1F8bc8f1C3dd342C7CEffCa4206831</div>
    <div class="eth-ts-r atnl-color-qd">转账的时候备注本人手机号码</div>
    <button type="button" class="btn btn-reg" id="btnInvite"
            data-clipboard-text="0x82Df18eB4C1F8bc8f1C3dd342C7CEffCa4206831">复制地址
    </button>
</div>
<script src="./resource/js/jquery.min.js"></script>
<script src="./resource/js/bootstrap.min.js"></script>
<script src="./resource/js/bootstrapValidator.js"></script>
<script src="./resource/js/utils.js"></script>
<script src="./resource/js/city-picker.data.js"></script>
<script src="./resource/js/city-picker.js"></script>
<script src="./resource/js/clipboard.min.js"></script>
<script src="./resource/js/functions.js"></script>
<script type="text/javascript">
    $(function () {
        post('user/info', {}, function (data) {
            if (data.err != "") {
                window.location.href = 'login.html';
            }
        });
        var oid = getParam('oid');
        post('order/get', {oid: oid}, function (data) {
            if (data.err != "") {

            } else {
                var orderinfo = data.data;
                if(orderinfo.pay_time==null){
                    orderinfo.pay_time="";
                }
                $("#orderId").text(orderinfo.id);
                $("#productnum").text(orderinfo.count);
                $("#msg").text(orderinfo.msg);
                $("#addr").text(orderinfo.addr);
                $("#name").text(orderinfo.name);
                $("#countMoney").text(orderinfo.price);
                $("#realPrice").text(orderinfo.realprice);
                $("#trackno").text(orderinfo.trackno);
                $("#proTitle").text(orderinfo.pname);
                $("#proPrice").text(orderinfo.pprice);
                $("#sendDate").text(orderinfo.send_date);
                $("#createTime").text(orderinfo.create_time);
                $("#paytime").text(orderinfo.pay_time);
                $("#extra").text(orderinfo.extra);
                $("#contacts").text(orderinfo.contacts);
                $(".product-img img").attr('src',orderinfo.logo);
                if(orderinfo.state == 1){
                    $("#orderState").html('待付款<button class="btn btn-default btn-sm" style="margin-left: 10px" onclick="toPay('+orderinfo.id+', '+orderinfo.paytype+')">去支付</button>')
                }
                if(orderinfo.state == 2){
                    $("#orderState").text("等待商家发货")
                }
                if(orderinfo.state == 3){
                    $("#orderState").text("已发货")
                }
                if(orderinfo.state == 4){
                    $("#orderState").text("已完成")
                }
                if(orderinfo.state == 0){
                    $("#orderState").text("已取消")
                }
                if (orderinfo.paytype == 1) {
                    $("#payWay").text('在线支付');
                }
                if (orderinfo.paytype == 2) {
                    $("#payWay").text('ETH支付');
                }
                if (orderinfo.paytype == 3) {
                    $("#payWay").text('ATNL兑换');
                }

                if (orderinfo.qid != 0) {
                    post('quan/get?qid=' + orderinfo.qid, {}, function (data) {
                        if (data.err != "") {

                        } else {
                            $("#couponMoney").html(data.data.money);
                        }
                    });
                }


            }
        });

        $("#btnCoupon").click(function(){
            $("#myModal").modal('show');
        })

        $("#closeEthPay").click(function(){
            $("#payWayEth").hide();
        })


    });

    var clipboard = new ClipboardJS('#btnInvite');

    clipboard.on('success', function (e) {
        alert("地址已复制到剪切板，粘贴到钱包支付！");
        e.clearSelection();
    });

    clipboard.on('error', function (e) {
    });

    function toPay(oid, paytype) {
        if (paytype == 1){
            if (is_weixn()) {
                window.location.href='http://wx.atunala.com/app/wx/pay?oid='+oid;
            } else {
                post('alipay/pay', {oid: oid}, function (data) {
                    if (data.err != "") {
                        if (data.err == undefined) {
                            $('body').append(data);
                            $("form").attr("target", "_blank");
                        } else {
                            alert(data.err);
                        }
                    }
                });
            }

        }
        if (paytype == 2){
            post('order/get', {oid:oid}, function (data) {
                if (data.err != "") {

                } else {
                    $("#eth").html(data.data.eth);
                }
            });
            $("#payWayEth").show();
        }

    }
</script>
</body>
</html>